<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Fuyao-Jiang"><meta name="description" content="区块链开发、golang、智能合约、共识算法、密码学、Bitcoin、Ethereum、Bitshare源码解析、超级账本"><link rel="alternative" href="/atom.xml" title="姜富耀 | BlockChain" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>区块链开发 Go语言：并发编程 - 姜富耀 | BlockChain</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0;"><header class="head"><h1 class="head-title u-fl"><a href="/">姜富耀 | BlockChain</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">☯ DIR'/（目录）</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2018-01-29T13:01:28.000Z">一月 29, 2018</time><h1 class="post__title"><a href="/2018/01/29/区块链开发-Go语言：并发编程/">区块链开发 Go语言：并发编程</a></h1><div class="post__main echo"><h2 id="串行-并发-的概念"><a href="#串行-并发-的概念" class="headerlink" title="串行 并发 的概念"></a>串行 并发 的概念</h2><blockquote>
<p><strong>进程</strong>：一个正在运行的程序一般就是一个进程，一个进程可以包含多个线程。<br><strong>线程</strong>：一堆有序的CPU命令的集合体<br>注意：一个CPU在同一时刻只能执行一个CPU命令。<br>假设我现在只有一个CPU，那么进行多线程编程,是通过 上下文切换，时间片的轮转分配。</p>
</blockquote>
<p>1.<strong>并发编程</strong>：多个线程，会有时间片的分配问题。多个线程之间会不断的来回切换。<br>2.<strong>串行编程</strong>：根据添加线程的顺序，按照顺序，一一去执行。</p>
<blockquote>
<p>CPU有如下两种：<br>1.<strong>物理CPU</strong><br>2.<strong>逻辑CPU（虚拟CPU）</strong><br>一个 物理CPU可以虚拟出多个逻辑CPU<br>8核 同一时刻可以同时最多执行8个CPU命令。  </p>
</blockquote>
<p>多线程编程<strong>优点</strong>： 分线程可以处理耗时操作，不会出现主线程阻塞。<br>多线程编程<strong>缺点</strong>：资源竞争，内存消耗，出现死锁。 </p>
<blockquote>
<p>出现 进程阻塞 案例 </p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//主线程 : 按照一定有序的CPU命令的顺序来依次执行。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  fmt.Println(<span class="string">"foo() start"</span>)</span><br><span class="line">  foo()</span><br><span class="line">  fmt.Println(<span class="string">"bar() start"</span>)</span><br><span class="line">  bar()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>;i &lt; <span class="number">1000000000</span>;i++ &#123;<span class="comment">//当计算时间很长时间，就会出现线程阻塞</span></span><br><span class="line">    fmt.Println(<span class="string">"i:"</span>,i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bar</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  <span class="keyword">for</span> j := <span class="number">0</span>;j &lt; <span class="number">200</span>;j++ &#123;</span><br><span class="line">    fmt.Println(<span class="string">"j:"</span>,j)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>runtime: 有两种形式，一种是一条直线，另一种是一个圈。<br>下面的Demo案例中，仍然是一条直线。<br>当程序执行到主函数中最后一个 } 时，分线程还没执行，整个程序结束 </p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  fmt.Println(<span class="string">"foo() start"</span>)</span><br><span class="line">  <span class="keyword">go</span> foo() <span class="comment">//产生一个分线程，（把foo()的执行，放到分线程中。）</span></span><br><span class="line">  fmt.Println(<span class="string">"foo() end"</span>)</span><br><span class="line">  fmt.Println(<span class="string">"bar() start"</span>)</span><br><span class="line">  <span class="keyword">go</span> bar() <span class="comment">//把bar()的执行，放到分线程中,</span></span><br><span class="line">  fmt.Println(<span class="string">"bar() end"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>;i &lt; <span class="number">100</span>;i++ &#123;</span><br><span class="line">    fmt.Println(<span class="string">"i"</span>,i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bar</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  <span class="keyword">for</span> j := <span class="number">0</span>;j &lt; <span class="number">200</span>;j++ &#123;</span><br><span class="line">    fmt.Println(<span class="string">"j"</span>,j)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>下面这个Demo里面，runtime是一个圆环，主线程一直不停，一直等待 分线程执行完，才结束。</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// wg是一个队列，主要用于管理线程。 </span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  wg.Add(<span class="number">2</span>) <span class="comment">//添加两个线程。(添加线程的个数)</span></span><br><span class="line">  <span class="keyword">go</span> foo() <span class="comment">//把foo()所有任务放到分线程</span></span><br><span class="line">  <span class="keyword">go</span> bar() <span class="comment">//把bar()所有任务放到分线程</span></span><br><span class="line">  wg.Wait()<span class="comment">// 主线程需要等待分线程去执行，只有队列中counter 计数器的值变为0时，主线程才会结束。runtime为一个圆圈。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    fmt.Println(<span class="string">"i"</span>,i)</span><br><span class="line">  &#125;</span><br><span class="line">  wg.Done() <span class="comment">//当分线程的任务处理完成，counter计数器 减 1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bar</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  <span class="keyword">for</span> j := <span class="number">0</span>;j &lt; <span class="number">20</span>;j++ &#123;</span><br><span class="line">    fmt.Println(<span class="string">"j"</span>,j)</span><br><span class="line">  &#125;</span><br><span class="line">  wg.Done() <span class="comment">//当分线程的任务处理完成，counter计数器 减 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="进程休眠"><a href="#进程休眠" class="headerlink" title="进程休眠"></a>进程休眠</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"sync"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  wg.Add(<span class="number">2</span>) <span class="comment">//添加两个分线程。(添加分线程的个数)</span></span><br><span class="line">  <span class="keyword">go</span> foo() <span class="comment">//把foo()所有任务放到分线程</span></span><br><span class="line">  <span class="keyword">go</span> bar() <span class="comment">//把bar()所有任务放到分线程</span></span><br><span class="line">  wg.Wait()<span class="comment">// 主线程需要等待分线程去执行，只有队列中counter 计数器的值变为0时，主线程才会结束。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    fmt.Println(<span class="string">"i"</span>,i)</span><br><span class="line">    time.Sleep(<span class="number">3</span> * time.Second) <span class="comment">//休眠3秒</span></span><br><span class="line">  &#125;</span><br><span class="line">  wg.Done() <span class="comment">//当分线程的任务处理完成，counter计数器 减 1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bar</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  <span class="keyword">for</span> j := <span class="number">0</span>;j &lt; <span class="number">20</span>;j++ &#123;</span><br><span class="line">    fmt.Println(<span class="string">"j"</span>,j)</span><br><span class="line">    time.Sleep(<span class="number">20</span> * time.Second) <span class="comment">//休眠20秒</span></span><br><span class="line">  &#125;</span><br><span class="line">  wg.Done() <span class="comment">//当分线程的任务处理完成，counter计数器 减 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>读取 CPU个数，以及设置 参与执行的CPU的个数</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"runtime"</span></span><br><span class="line">	<span class="string">"sync"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="comment">// runtime.NumCPU() 逻辑CPU个数</span></span><br><span class="line"><span class="comment">// runtime.GOMAXPROCS设置机器能够参与执行的CPU的个数</span></span><br><span class="line"><span class="comment">// init()方法会在main函数之前执行</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"init()"</span>)</span><br><span class="line">	fmt.Println(runtime.NumCPU())</span><br><span class="line"></span><br><span class="line">	runtime.GOMAXPROCS(runtime.NumCPU())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"main() start()"</span>)</span><br><span class="line">	wg.Add(<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">go</span> foo()</span><br><span class="line">	<span class="keyword">go</span> bar()</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">45</span>; i++ &#123;</span><br><span class="line">		fmt.Println(<span class="string">"Foo:"</span>, i)</span><br><span class="line">		time.Sleep(<span class="number">3</span> * time.Millisecond)</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bar</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">45</span>; i++ &#123;</span><br><span class="line">		fmt.Println(<span class="string">"Bar:"</span>, i)</span><br><span class="line">		time.Sleep(<span class="number">20</span> * time.Millisecond)</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Done()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>终端 运行 <code>$ go run -race main.go</code>检查 是否有资源竞争。</p>
<p>资源竞争案例</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  a := <span class="number">1</span></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span> <span class="params">()</span></span>  &#123; <span class="comment">//匿名函数，分线程</span></span><br><span class="line">    a = <span class="number">2</span> </span><br><span class="line">    fmt.Println(<span class="string">"a is func "</span>,a)</span><br><span class="line">  &#125;()</span><br><span class="line">  a =<span class="number">3</span>  <span class="comment">//主线程改为3，休眠，分线程改为2，所以结果都为2。</span></span><br><span class="line">  time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line">  fmt.Println(<span class="string">"a is main "</span>, a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="生成随机数"><a href="#生成随机数" class="headerlink" title="生成随机数"></a>生成随机数</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"math/rand"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//随机生成一个10以下的随机数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  rand.Seed(time.Now().UnixNano())<span class="comment">//时间种子，不设置的话，每次生成的随机数相同。</span></span><br><span class="line">  randNum := rand.Intn(<span class="number">20</span>)</span><br><span class="line">  fmt.Println(randNum)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="互斥-和-上锁"><a href="#互斥-和-上锁" class="headerlink" title="互斥 和 上锁"></a>互斥 和 上锁</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mutex sync.Mutex <span class="comment">//互斥</span></span><br><span class="line"></span><br><span class="line">mutex.Lock() <span class="comment">//上锁</span></span><br><span class="line"><span class="comment">//上锁后被锁定的内容，不会被 两个或多个线程修改。</span></span><br><span class="line">mutex.Unlock() <span class="comment">//解锁</span></span><br></pre></td></tr></table></figure>
<h3 id="原子操作"><a href="#原子操作" class="headerlink" title="原子操作"></a>原子操作</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"math/rand"</span></span><br><span class="line">  <span class="string">"sync/atomic"</span> <span class="comment">//原子操作</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//原子操作：下面代码是让 counter +1，但是无法使第二行代码不被人改变。</span></span><br><span class="line">atomic.AddInt64(&amp;counter, <span class="number">1</span>)</span><br><span class="line">fmt.Println(.....)</span><br></pre></td></tr></table></figure>
<h3 id="json-格式-编码、解码，流式编解码"><a href="#json-格式-编码、解码，流式编解码" class="headerlink" title="json 格式 编码、解码，流式编解码"></a>json 格式 编码、解码，流式编解码</h3><blockquote>
<p>把 对象属性 进行 json 格式字符串 (编码)</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//利用普通编码将结构体对象的属性数据导出为json格式</span></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"encoding/json"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="keyword">string</span></span><br><span class="line">  Age <span class="keyword">string</span></span><br><span class="line">  Id <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  p1 := Person&#123;<span class="string">"jiangfuyao"</span>,<span class="string">"20"</span>,<span class="string">"100"</span>&#125;</span><br><span class="line">  p2 := Person&#123;<span class="string">"jiangfuyao"</span>,<span class="string">"20"</span>,<span class="string">"101"</span>&#125;</span><br><span class="line">  p3 := Person&#123;<span class="string">"jiangfuyao"</span>,<span class="string">"20"</span>,<span class="string">"102"</span>&#125;</span><br><span class="line">  p4 := Person&#123;<span class="string">"jiangfuyao"</span>,<span class="string">"20"</span>,<span class="string">"103"</span>&#125;</span><br><span class="line">  <span class="keyword">var</span> arrPerson = [<span class="number">4</span>]Person&#123;p1,p2,p3,p4&#125;</span><br><span class="line">  <span class="keyword">var</span> arrJson =[<span class="number">4</span>]<span class="keyword">string</span>&#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> key,value := <span class="keyword">range</span> arrPerson &#123;</span><br><span class="line"></span><br><span class="line">    bs, err := json.Marshal(value)</span><br><span class="line">    <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="comment">//转换成功</span></span><br><span class="line">      <span class="comment">// fmt.Println(string(bs))</span></span><br><span class="line">      arrJson[key] = <span class="keyword">string</span>(bs)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(arrJson)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>把json格式字符串，转换成 对象属性储存 (解码)</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"encoding/json"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="keyword">string</span>  <span class="string">`json:"name"`</span></span><br><span class="line">  Age <span class="keyword">string</span>   <span class="string">`json:"age"`</span></span><br><span class="line">  Id <span class="keyword">string</span>    <span class="string">`json:"id"`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  personArr := [<span class="number">3</span>]Person&#123;&#125;</span><br><span class="line">  bs := []<span class="keyword">byte</span>(<span class="string">`[&#123;"name":"jiangfuyao","age":"20","id":"100"&#125;,&#123;"name":"jiangfuyao","age":"20","id":"101"&#125;,&#123;"name":"jiangfuyao","age":"20","id":"102"&#125;,&#123;"name":"jiangfuyao","age":"20","id":"103"&#125;]`</span>)</span><br><span class="line">  json.Unmarshal(bs, &amp;personArr)</span><br><span class="line">  <span class="keyword">for</span> _,value := <span class="keyword">range</span> personArr &#123;</span><br><span class="line">    fmt.Println(value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>用<strong>流式编码</strong>，将结构体对象的属性数据导出为json格式</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"encoding/json"</span></span><br><span class="line">  <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="keyword">string</span></span><br><span class="line">  Age <span class="keyword">string</span></span><br><span class="line">  Id <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  p1 := Person&#123;<span class="string">"jiangfuyao"</span>,<span class="string">"20"</span>,<span class="string">"100"</span>&#125;</span><br><span class="line">  p2 := Person&#123;<span class="string">"jiangfuyao"</span>,<span class="string">"20"</span>,<span class="string">"101"</span>&#125;</span><br><span class="line">  p3 := Person&#123;<span class="string">"jiangfuyao"</span>,<span class="string">"20"</span>,<span class="string">"102"</span>&#125;</span><br><span class="line">  p4 := Person&#123;<span class="string">"jiangfuyao"</span>,<span class="string">"20"</span>,<span class="string">"103"</span>&#125;</span><br><span class="line">  <span class="keyword">var</span> arrPerson = [<span class="number">4</span>]Person&#123;p1,p2,p3,p4&#125;</span><br><span class="line">json.NewEncoder(os.Stdout).Encode(arrPerson)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>流式 解码</strong></p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"encoding/json"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="keyword">string</span>  <span class="string">`json:"name"`</span></span><br><span class="line">  Age <span class="keyword">string</span>   <span class="string">`json:"age"`</span></span><br><span class="line">  Id <span class="keyword">string</span>    <span class="string">`json:"id"`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">  <span class="keyword">var</span> personArr = [<span class="number">3</span>]Person&#123;&#125;</span><br><span class="line">  rdr := strings.NewReader(<span class="string">`[&#123;"name":"jiangfuyao","age":"20","id":"100"&#125;,&#123;"name":"jiangfuyao","age":"20","id":"101"&#125;,&#123;"name":"jiangfuyao","age":"20","id":"102"&#125;,&#123;"name":"jiangfuyao","age":"20","id":"103"&#125;]`</span>)</span><br><span class="line">  json.NewDecoder(rdr).Decode(&amp;personArr)</span><br><span class="line">  <span class="keyword">for</span> _,value := <span class="keyword">range</span> personArr &#123;</span><br><span class="line">    fmt.Println(value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<blockquote>
<p><strong><em>日后随着 学习打怪的不断深入，会解锁其他的高级教程。</em></strong>  </p>
<h3 id="期待-吗？-那就关注下面-公众号-随时锁定区块链开发学习教程进度-："><a href="#期待-吗？-那就关注下面-公众号-随时锁定区块链开发学习教程进度-：" class="headerlink" title="期待 吗？ 那就关注下面 公众号 随时锁定区块链开发学习教程进度 ：)"></a><strong><em>期待 吗？ 那就关注下面 公众号 随时锁定区块链开发学习教程进度 ：)</em></strong></h3></blockquote>
</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/Golang/">Golang</a></li></ul></footer></article><section class="reward"><a class="btn-reward" href="#">关注公众号</a><div class="reward-wrapper clearfix"><img src="/img/wechat.jpg" title="公众号：区块链开发技术共享"><img src="/img/lianhu.jpg" title="公众号：区块链部落"></div></section><div class="comments" id="lv-container" data-id="city" data-uid="MTAyMC8zMzU4MC8xMDEzNQ=="><script>(function(d, s) {var j, e = d.getElementsByTagName(s)[0];if (typeof LivereTower === 'function') { return; } j = d.createElement(s);j.src = 'https://cdn-city.livere.com/js/embed.dist.js';j.async = true;e.parentNode.insertBefore(j, e);})(document, 'script');</script></div></main><footer class="foot"><div class="foot-copy">&copy; 2018 Fuyao-Jiang</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>